name: Deploy <APP_NAME> (<ENV> ‚Äì Frontend Sync)

on:
  workflow_dispatch:
    inputs:
      app_name:
        description: "App name (e.g. rail-frontend / air-frontend)"
        required: true
        type: string

      env:
        description: "Environment"
        required: true
        type: choice
        options:
          - dev
          - staging
          - prod

jobs:
  deploy:
    name: Deploy ${{ inputs.app_name }} (${{ inputs.env }})
    runs-on: [self-hosted, frontend-sync]

    steps:
      - name: üßæ Checkout repository
        uses: actions/checkout@v4

      - name: üñ• Runner info
        run: |
          echo "Runner Host : $(hostname -s)"
          echo "App         : ${{ inputs.app_name }}"
          echo "Environment : ${{ inputs.env }}"

      - name: üöÄ Run Sync Deploy
        run: |
          DEPLOY_SCRIPT="/var/www/apps/${{ inputs.env }}/${{ inputs.app_name }}/scripts/deploy.sh"

          if [ ! -x "$DEPLOY_SCRIPT" ]; then
            echo "‚ùå Deploy script not found: $DEPLOY_SCRIPT"
            exit 1
          fi

          echo "‚ñ∂ Running deploy script"
          bash "$DEPLOY_SCRIPT"
