#!/usr/bin/env bash
set -e

APP_NAME="__APP_NAME__"
ENV="__ENV__"
PM2_NAME="__PM2_NAME__"
PORT="__PORT__"

BASE="/var/www/apps/$ENV/$APP_NAME"
CURRENT="$BASE/current"
DIST="$CURRENT/dist/apps/$APP_NAME"

echo "ðŸ”„ Reloading Nx Next.js on $(hostname)"

cd "$BASE"

pm2 reload "$PM2_NAME" || pm2 start npm \
  --name "$PM2_NAME" \
  --cwd "$DIST" \
  --env production \
  -- start -- -p "$PORT"

pm2 save
echo "âœ… Nx Next.js ready on $(hostname)"
