#!/bin/bash
set -e

APP_NAME="__APP_NAME__"
ENV="__ENV__"

BASE="/var/www/apps/$ENV/$APP_NAME"
CURRENT="$BASE/current"
BACKUP="$BASE/backup"

echo "‚è™ Rolling back $APP_NAME on $ENV..."

if [ ! -d "$BACKUP" ]; then
  echo "‚ùå No backup found!"
  exit 1
fi

# Remove current build
rm -rf "$CURRENT"

# Restore backup
mv "$BACKUP" "$CURRENT"

echo "üîÑ Restarting PM2..."
pm2 restart all

echo "‚úÖ Rollback complete!"
